
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>S.A.L.T</title>
    <link rel="stylesheet" href="index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="icon" type="image/svg+xml" href="logo.svg">
    <meta id="theme-color-meta" name="theme-color" content="#2E9E6C">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="logo-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
    
    <div id="app-container">
        <!-- Login Overlay -->
        <div id="login-overlay" class="active">
            <div id="login-modal">
                <img src="logo.svg" alt="S.A.L.T Logo" class="login-logo">
                <h2>S.A.L.T</h2>
                <p class="login-subtitle">Sharing And Living Together</p>
                <form id="login-form">
                    <input type="tel" id="phone-input" placeholder="Phone Number" required autocomplete="tel">
                    <button type="submit" id="send-code-btn" class="login-btn">Sign In</button>
                    <div class="test-account-hint" style="border-top:1px solid #f1f5f9; padding-top:1rem; margin-top:1.5rem;">
                        <p style="font-size:0.75rem; color:#94a3b8; margin-bottom:8px;">Try Demo Accounts:</p>
                        <div class="test-numbers" style="display:flex; gap:8px; justify-content:center;">
                            <button type="button" class="test-number-chip" data-phone="9800000001" style="background:#f1f5f9; border:none; padding:6px 12px; border-radius:20px; font-size:0.7rem; color:#475569; cursor:pointer;">Admin</button>
                            <button type="button" class="test-number-chip" data-phone="1234" style="background:#f1f5f9; border:none; padding:6px 12px; border-radius:20px; font-size:0.7rem; color:#475569; cursor:pointer;">User</button>
                        </div>
                    </div>
                     <p id="login-error" style="color:red; font-size:0.8rem; margin-top:8px;"></p>
                </form>
            </div>
        </div>

        <!-- Global Header -->
        <header>
            <div style="width: 32px;"></div> <!-- Spacer for balance -->
            <h1 id="header-title">Welcome</h1>
            <div class="header-actions">
                <!-- Notification Button & Panel -->
                <div style="position: relative;">
                    <button id="notification-btn" aria-label="Notifications">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>
                        <span id="notification-badge" class="hidden" style="position:absolute; top:8px; right:8px; width:8px; height:8px; background:red; border-radius:50%; border:1px solid white;"></span>
                    </button>
                    <div id="notification-panel" class="hidden">
                        <ul id="notification-list" style="list-style:none; padding:0; margin:0;">
                             <li style="padding:16px; border-bottom:1px solid #f1f5f9; font-size:0.9rem; color:#333;">No new notifications</li>
                        </ul>
                    </div>
                </div>

                <!-- More Menu Button & Dropdown -->
                <div style="position: relative;">
                    <button id="more-menu-btn" aria-label="Menu">
                         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
                    </button>
                    <div id="more-menu-dropdown" class="dropdown-menu hidden">
                        <div class="dropdown-header">Account</div>
                        <button id="dropdown-admin-btn">Admin Mode</button>
                        <button id="dropdown-logout-btn" style="color:#ef4444 !important;">Logout</button>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <!-- Welcome -->
            <section id="welcome" class="content-section active">
                <div id="welcome-hero" style="position: relative; height: 220px; overflow: hidden; margin-bottom: 1rem;">
                     <img src="https://images.unsplash.com/photo-1508361001413-762174338279?q=80&w=2070&auto=format&fit=crop" alt="Church" style="width:100%; height:100%; object-fit:cover;" />
                    <div class="hero-content" style="position:absolute; bottom:0; left:0; width:100%; padding:2rem 1.5rem; background:linear-gradient(to top, rgba(0,0,0,0.8), transparent); color:white;">
                        <h2 id="welcome-church-name" style="margin-bottom:0.5rem; text-shadow:0 1px 3px rgba(0,0,0,0.5); font-size:1.5rem; color: white;">Welcome!</h2>
                        <p id="welcome-message" style="font-size:0.95rem; opacity:0.9; color: #f0fdf4;">Please select a church.</p>
                    </div>
                </div>
                <div class="page-padding">
                    <h3 style="margin-bottom:0.8rem; color:var(--text-main); font-size:1.1rem;">Latest Updates</h3>
                    <div id="home-news-preview"></div>
                </div>
            </section>

            <!-- Live Service -->
            <section id="live" class="content-section">
                <div class="page-padding">
                    <div class="card" style="padding:0; overflow:hidden;">
                        <div class="video-player-container" style="position:relative; padding-bottom:56.25%; height:0; background:#000;">
                            <iframe id="video-player" src="" style="position:absolute; top:0; left:0; width:100%; height:100%;" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div style="padding:1.25rem;">
                            <h2 style="font-size:1.2rem; margin-bottom:0.5rem;">Live Worship</h2>
                            <p style="color:var(--text-sub); font-size:0.9rem;">Join us online for our Sunday service.</p>
                        </div>
                    </div>
                    
                    <h3 style="margin:1.5rem 0 0.8rem 4px; font-size:1.1rem;">Recent Sermons</h3>
                    <div class="card" style="padding:0; overflow:hidden;">
                        <ul id="sermon-list" style="list-style:none;"></ul>
                    </div>
                </div>
            </section>

            <!-- Prayer -->
            <section id="prayer" class="content-section">
                <div class="page-padding">
                    <button id="prayer-form-toggle" class="prayer-compose-trigger">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h-2v-6h2v6zm1-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"/></svg>
                        Share a Prayer Request
                    </button>

                    <div id="prayer-form-wrapper" class="prayer-form-container hidden">
                        <h3 style="margin-bottom:1rem; font-size:1.1rem;">New Prayer Request</h3>
                        <form id="prayer-form">
                            <input type="text" id="prayer-title-input" class="modern-input" placeholder="Title (e.g., Healing for mom)" required>
                            <textarea id="prayer-input" class="modern-input" placeholder="Details..." required style="min-height:80px; resize:none;"></textarea>
                            <div class="form-actions">
                                <button type="button" id="cancel-prayer-btn" class="btn-cancel">Cancel</button>
                                <button type="submit" class="btn-submit">Post</button>
                            </div>
                        </form>
                    </div>

                    <h3 style="margin-bottom:0.8rem; padding-left:4px; font-size:1.1rem;">Community Prayers</h3>
                    <div id="prayer-list"></div>
                </div>
            </section>
            
            <!-- Bible -->
            <section id="bible" class="content-section">
                <div class="page-padding">
                    <div class="card">
                        <h3 style="font-size:1.1rem; margin-bottom:0.5rem;">ðŸ“– Daily Devotion</h3>
                        <p style="line-height:1.6; color:var(--text-sub);">"For I know the plans I have for you," declares the LORD, "plans to prosper you and not to harm you, plans to give you hope and a future."</p>
                        <span class="news-date" style="margin-top:1rem; display:block; text-align:right; color:var(--text-light); font-size:0.8rem;">Jeremiah 29:11</span>
                    </div>
                    <div class="card">
                        <h3 style="font-size:1.1rem; margin-bottom:1rem;">Reading Plan</h3>
                        <div id="bible-reading-plan" style="display:grid; grid-template-columns:repeat(7, 1fr); gap:6px;"></div>
                    </div>
                </div>
            </section>

            <!-- News -->
            <section id="news" class="content-section">
                 <div class="page-padding">
                    <h2 style="margin-bottom:1rem; font-size:1.3rem;">News & Events</h2>
                    <div id="news-list"></div>
                </div>
            </section>

            <!-- Chat Tab (List View) -->
            <section id="chat" class="content-section">
                <!-- Chat List -->
                <div id="chat-list-view" class="active" style="position:relative; min-height:100%;">
                    <div id="chat-list-container"></div>
                    <button id="chat-fab-btn" class="fab-btn" aria-label="New Chat">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
                    </button>
                </div>

                <!-- New Chat Search View -->
                <div id="new-chat-view" class="hidden" style="display:flex; flex-direction:column; height:100%;">
                     <div class="chat-header">
                        <button id="new-chat-back-btn" style="background:none; border:none; padding:4px; color:var(--text-main); cursor:pointer;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                        </button>
                        <h3 style="font-size:1.1rem; margin:0;">New Chat</h3>
                    </div>
                    <div style="padding:1rem; flex-shrink:0;">
                        <input type="search" id="user-search-input" placeholder="Search people..." class="modern-input" style="margin-bottom:0;">
                    </div>
                    <div id="user-list-container" style="flex:1; overflow-y:auto;"></div>
                </div>
            </section>
            
            <!-- Chat Detail View (Overlays Main Content) -->
            <div id="chat-detail-view" class="content-section">
                <div class="chat-header">
                    <button id="chat-back-btn" style="border:none; background:none; padding:4px; color:var(--text-main); cursor:pointer;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                    </button>
                    <h3 id="chat-detail-title" style="font-size:1.1rem; margin:0;">Chat</h3>
                </div>
                <div class="chat-messages"></div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" class="modern-input" style="margin-bottom:0; border-radius:24px; padding:10px 16px; border:1px solid #ddd;" placeholder="Message..." />
                    <button id="chat-send-btn" style="border:none; background:none; color:var(--primary-color); cursor:pointer;">
                         <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                    </button>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-target="welcome">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                <span>Home</span>
            </button>
            <button class="nav-item" data-target="live">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/></svg>
                <span>Worship</span>
            </button>
            <button class="nav-item" data-target="news">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6zm-2 0l-8 5-8-5h16zm0 12H4V8l8 5 8-5v10z"/></svg>
                <span>News</span>
            </button>
            <button class="nav-item" data-target="bible">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9 18H7v-2h2v2zm0-4H7v-2h2v2zm0-4H7V8h2v2zm4 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V8h2v2zm4 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V8h2v2z"/></svg>
                <span>Bible</span>
            </button>
            <button class="nav-item" data-target="prayer">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16.5 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-3.5 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-3.5 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-3.5 0C4.9 6 4 6.9 4 8s.9 2 2 2 2-.9 2-2-.9-2-2-2zM20 18H4v-1.5h16V18zM4 21.5h16V20H4v1.5z"/></svg>
                <span>Prayer</span>
            </button>
            <button class="nav-item" data-target="chat">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
                <span>Chat</span>
            </button>
        </nav>
    </div>

    <script>
    // --- APP DATA ---
    const mockUsers = {
        '9800000001': { userId: 'user1', churchId: 'grace-church', name: 'Admin User' },
        '9800000002': { userId: 'user5', churchId: 'hope-fellowship', name: 'Pastor David' },
        '1234': { userId: 'user1', churchId: 'grace-church', name: 'Test User' }
    };

    const mockDatabase = {
        'grace-church': {
            name: 'Grace Community Church',
            welcomeMessage: 'Sharing faith, hope, and love.',
            liveServiceVideoId: '5qap5aO4i9A',
            members: [
                { id: 'user1', name: 'Admin User', isAdmin: true, avatarColor: '#3B82F6' },
                { id: 'user2', name: 'Pastor John', isAdmin: false, avatarColor: '#EF4444' },
                { id: 'user3', name: 'Jane Doe', isAdmin: false, avatarColor: '#10B981' },
            ],
            sermons: [{ videoId: 'Y-i4p4O7a_0', title: 'The Courage to Hope', speaker: 'Pastor John', date: 'May 19' }, { videoId: 'jNQXAC9IVRw', title: 'Love That Transforms', speaker: 'Pastor Jane', date: 'May 12' }],
            prayers: [{ id: 'p1', postedBy: 'user3', timestamp: new Date().toISOString(), title: 'Family Health', text: 'Please pray for my mother who is undergoing surgery next week.', prayedCount: 12 }],
            news: [
                { title: 'Summer Retreat 2024', text: 'Join us for a weekend of fellowship and spiritual growth at the mountain retreat center.', date: 'May 15' },
                { title: 'Community Lunch', text: 'Potluck lunch after the service this Sunday. Bring your favorite dish!', date: 'May 20' }
            ],
            chats: [
                { id: 'chat1', name: 'Youth Group', type: 'group', members: ['user1', 'user3'], preview: 'See you at 6pm!', avatarColor: '#EC4899' },
                { id: 'chat2', name: 'Pastor John', type: 'direct', members: ['user1', 'user2'], preview: 'Can we meet briefly?', avatarColor: '#3B82F6' }
            ]
        },
        'hope-fellowship': {
            name: 'Hope Fellowship',
            welcomeMessage: 'Welcome to Hope Fellowship!',
            liveServiceVideoId: 'tSBFz_MDnLs',
            members: [{ id: 'user5', name: 'Pastor David', isAdmin: true, avatarColor: '#10B981' }],
            sermons: [],
            prayers: [],
            news: [],
            chats: []
        }
    };

    let currentChurchId = null;
    let churchData = null;
    let currentUser = null;

    // --- INITIALIZATION ---
    (function() {
        if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
        else init();
    })();

    function init() {
        const saved = localStorage.getItem('churchAppSession');
        if(saved) {
            try {
                const s = JSON.parse(saved);
                if(s && mockUsers[s.phone]) loginSuccess(s.phone, true);
                else showLogin();
            } catch(e) { showLogin(); }
        } else {
            showLogin();
        }
        
        setupEvents();
    }

    function setupEvents() {
        // Login
        document.getElementById('login-form')?.addEventListener('submit', (e) => { e.preventDefault(); handleLogin(); });
        document.getElementById('send-code-btn')?.addEventListener('click', (e) => { e.preventDefault(); handleLogin(); });
        
        // Test Chips
        document.querySelectorAll('.test-number-chip').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('phone-input').value = btn.dataset.phone;
                handleLogin();
            });
        });

        // Navigation
        document.querySelectorAll('.nav-item').forEach(btn => {
            btn.addEventListener('click', () => {
                const target = btn.dataset.target;
                if(target) showSection(target);
            });
        });

        // Prayer Form Toggle
        document.getElementById('prayer-form-toggle')?.addEventListener('click', () => {
            document.getElementById('prayer-form-toggle').classList.add('hidden');
            document.getElementById('prayer-form-wrapper').classList.remove('hidden');
        });
        document.getElementById('cancel-prayer-btn')?.addEventListener('click', () => {
             document.getElementById('prayer-form-wrapper').classList.add('hidden');
             document.getElementById('prayer-form-toggle').classList.remove('hidden');
        });
        document.getElementById('prayer-form')?.addEventListener('submit', (e) => {
            e.preventDefault();
            // Handle mock submit
            const title = document.getElementById('prayer-title-input').value;
            const text = document.getElementById('prayer-input').value;
            // Add to mock data...
            alert('Prayer posted!');
            document.getElementById('prayer-title-input').value = '';
            document.getElementById('prayer-input').value = '';
            document.getElementById('cancel-prayer-btn').click();
        });


        // FAB New Chat
        document.getElementById('chat-fab-btn')?.addEventListener('click', () => {
            document.getElementById('chat-list-view').classList.add('hidden');
            document.getElementById('new-chat-view').classList.remove('hidden');
            document.getElementById('new-chat-view').classList.add('active'); // CSS helper
            
            // Populate mock users
            const userList = document.getElementById('user-list-container');
            userList.innerHTML = '';
            churchData.members.forEach(m => {
                if(m.id === currentUser.userId) return;
                const d = document.createElement('div');
                d.className = 'chat-list-item';
                d.innerHTML = `<div class="chat-avatar" style="background:${m.avatarColor}">${m.name.charAt(0)}</div><div>${m.name}</div>`;
                d.onclick = () => {
                    openChat({ name: m.name, avatarColor: m.avatarColor, preview: 'New chat', id: 'new' });
                };
                userList.appendChild(d);
            });
        });
        document.getElementById('new-chat-back-btn')?.addEventListener('click', showChatList);

        // More Menu
        document.getElementById('more-menu-btn')?.addEventListener('click', (e) => {
            e.stopPropagation();
            document.getElementById('more-menu-dropdown').classList.toggle('hidden');
            document.getElementById('notification-panel').classList.add('hidden');
        });
        document.getElementById('dropdown-logout-btn')?.addEventListener('click', logout);

        // Notification Button
        document.getElementById('notification-btn')?.addEventListener('click', (e) => {
            e.stopPropagation();
            const panel = document.getElementById('notification-panel');
            panel.classList.toggle('hidden');
            document.getElementById('more-menu-dropdown').classList.add('hidden');
            
            if(!panel.classList.contains('hidden')) {
                const list = document.getElementById('notification-list');
                list.innerHTML = '<li class="notification-item" style="padding:1rem; border-bottom:1px solid #eee; font-size:0.9rem;">Welcome to S.A.L.T!</li>';
                document.getElementById('notification-badge').classList.add('hidden');
            }
        });

        // Chat
        document.getElementById('chat-back-btn')?.addEventListener('click', showChatList);
        document.getElementById('chat-send-btn')?.addEventListener('click', sendChatMessage);
        
        // Global clicks
        document.addEventListener('click', (e) => {
            if(!e.target.closest('#more-menu-btn') && !e.target.closest('#more-menu-dropdown')) {
                document.getElementById('more-menu-dropdown')?.classList.add('hidden');
            }
            if(!e.target.closest('#notification-btn') && !e.target.closest('#notification-panel')) {
                document.getElementById('notification-panel')?.classList.add('hidden');
            }
        });
    }

    // --- LOGIN LOGIC ---
    function handleLogin() {
        const phone = document.getElementById('phone-input').value.replace(/\D/g, '');
        if(mockUsers[phone]) loginSuccess(phone);
        else document.getElementById('login-error').textContent = "User not found.";
    }

    function loginSuccess(phone, silent) {
        const user = mockUsers[phone];
        currentChurchId = user.churchId;
        churchData = mockDatabase[currentChurchId];
        currentUser = { ...user, ...churchData.members.find(m => m.id === user.userId) };
        
        localStorage.setItem('churchAppSession', JSON.stringify({ phone, userId: currentUser.userId }));
        
        const overlay = document.getElementById('login-overlay');
        overlay.classList.remove('active');
        overlay.classList.add('hidden');
        overlay.style.display = 'none';

        loadChurchData();
        if(!silent) showSection('welcome');
    }

    function showLogin() {
        const overlay = document.getElementById('login-overlay');
        overlay.classList.remove('hidden');
        overlay.classList.add('active');
        overlay.style.removeProperty('display');
    }

    function logout() {
        localStorage.removeItem('churchAppSession');
        location.reload();
    }

    // --- VIEW LOGIC ---
    function showSection(id) {
        // Reset Chat View state if leaving chat
        if (id !== 'chat') {
            document.getElementById('chat-detail-view').classList.remove('active');
            document.querySelector('.bottom-nav').style.display = 'flex'; // Ensure nav is visible
            document.querySelector('header').style.display = 'flex'; // Ensure header is visible
        }

        document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(el => el.classList.toggle('active', el.dataset.target === id));
        
        const titleMap = { welcome: 'Home', live: 'Worship', prayer: 'Prayer', bible: 'Bible', news: 'News', chat: 'Chat' };
        document.getElementById('header-title').textContent = titleMap[id] || 'S.A.L.T';

        if(id === 'chat') showChatList();
    }

    function loadChurchData() {
        if(!churchData) return;
        
        document.getElementById('welcome-church-name').textContent = churchData.name;
        document.getElementById('welcome-message').textContent = churchData.welcomeMessage;
        
        // Sermons
        const sList = document.getElementById('sermon-list');
        sList.innerHTML = '';
        churchData.sermons.forEach(s => {
            const li = document.createElement('li');
            li.style.cssText = "padding:1rem; border-bottom:1px solid #f1f5f9; cursor:pointer; display:flex; justify-content:space-between; align-items:center;";
            li.innerHTML = `<div><div style="font-weight:600; font-size:0.95rem; margin-bottom:2px;">${s.title}</div><div style="font-size:0.8rem; color:#64748b;">${s.speaker}</div></div><div style="font-size:0.75rem; color:#94a3b8;">${s.date}</div>`;
            li.onclick = () => document.getElementById('video-player').src = `https://www.youtube.com/embed/${s.videoId}`;
            sList.appendChild(li);
        });
        if(churchData.liveServiceVideoId) {
             document.getElementById('video-player').src = `https://www.youtube.com/embed/${churchData.liveServiceVideoId}`;
        }

        // News (Home Preview & Main News)
        const homeNews = document.getElementById('home-news-preview');
        const nList = document.getElementById('news-list');
        nList.innerHTML = '';
        homeNews.innerHTML = '';
        
        churchData.news.forEach((n, index) => {
            // Main News List
            const div = document.createElement('div');
            div.className = 'news-card'; 
            div.innerHTML = `<h3>${n.title}</h3><p>${n.text}</p><span class="news-date">${n.date}</span>`;
            nList.appendChild(div);

            // Home Preview (First 2)
            if(index < 2) {
                const previewDiv = div.cloneNode(true);
                homeNews.appendChild(previewDiv);
            }
        });

        // Prayer
        const pList = document.getElementById('prayer-list');
        pList.innerHTML = '';
        churchData.prayers.forEach(p => {
            const user = churchData.members.find(m => m.id === p.postedBy) || { name:'Unknown', avatarColor:'#ccc' };
            const div = document.createElement('div');
            div.className = 'prayer-card';
            div.innerHTML = `
                <div class="prayer-card-header">
                    <div class="prayer-card-avatar" style="background-color:${user.avatarColor};">${user.name.charAt(0)}</div>
                    <div class="prayer-card-userinfo">
                        <span class="prayer-card-username" style="font-weight:700; color:#064E3B;">${user.name}</span>
                        <span class="prayer-card-time" style="font-size:0.75rem; color:#6b7280; margin-left:8px;">${new Date(p.timestamp).toLocaleDateString()}</span>
                    </div>
                </div>
                <div class="prayer-card-content">
                    <h3>${p.title}</h3>
                    <p>${p.text}</p>
                </div>
                <div class="prayer-card-actions">
                    <button class="action-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                        Pray (${p.prayedCount})
                    </button>
                </div>
            `;
            pList.appendChild(div);
        });

        // Chat List
        const cList = document.getElementById('chat-list-container');
        cList.innerHTML = '';
        churchData.chats.forEach(chat => {
            const div = document.createElement('div');
            div.className = 'chat-list-item';
            div.innerHTML = `
                <div class="chat-avatar" style="background-color:${chat.avatarColor}">${chat.name.charAt(0)}</div>
                <div class="chat-list-details">
                    <div class="chat-list-title">${chat.name}</div>
                    <div class="chat-list-preview">${chat.preview}</div>
                </div>
            `;
            div.onclick = () => openChat(chat);
            cList.appendChild(div);
        });
        
        // Reading Plan
        const readingPlan = document.getElementById('bible-reading-plan');
        readingPlan.innerHTML = '';
        const days = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
        for(let i=0; i<7; i++) {
             const div = document.createElement('div');
             div.style.cssText = `background:${i===0?'var(--primary-color)':'var(--input-bg)'}; color:${i===0?'white':'var(--text-sub)'}; border-radius:8px; height:36px; display:flex; align-items:center; justify-content:center; font-size:0.75rem; font-weight:700;`;
             div.textContent = days[i];
             readingPlan.appendChild(div);
        }
    }

    // --- CHAT FUNCTIONS ---
    function showChatList() {
        document.getElementById('chat-list-view').classList.remove('hidden');
        document.getElementById('chat-list-view').classList.add('active');
        document.getElementById('chat-detail-view').classList.remove('active'); // Hide detail
        document.getElementById('new-chat-view').classList.add('hidden');
        document.getElementById('header-title').textContent = 'Chat';
        
        // Re-show global header and nav
        document.querySelector('header').style.display = 'flex';
        document.querySelector('.bottom-nav').style.display = 'flex';
    }

    function openChat(chat) {
        currentChat = chat;
        document.getElementById('chat-list-view').classList.add('hidden');
        
        // Activate Detail View
        const detailView = document.getElementById('chat-detail-view');
        detailView.classList.add('active'); // Ensure flex display
        
        document.getElementById('chat-detail-title').textContent = chat.name;
        
        // Hide global nav elements to focus on chat
        document.querySelector('.bottom-nav').style.display = 'none';
        document.querySelector('header').style.display = 'none';

        const msgs = document.querySelector('.chat-messages');
        msgs.innerHTML = `<div class="message-bubble other">Welcome to ${chat.name}!</div>`;
    }

    function sendChatMessage() {
        const input = document.getElementById('chat-input');
        const text = input.value.trim();
        if(!text) return;

        const msgs = document.querySelector('.chat-messages');
        const bubble = document.createElement('div');
        bubble.className = 'message-bubble me';
        bubble.textContent = text;
        msgs.appendChild(bubble);
        msgs.scrollTop = msgs.scrollHeight;
        input.value = '';
    }
    </script>
</body>
</html>
