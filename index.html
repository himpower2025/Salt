<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>S.A.L.T</title>
    <link rel="stylesheet" href="index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <meta name="theme-color" content="#6A89A4">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="logo-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
    <!-- Login Overlay -->
    <div id="login-overlay" class="active">
        <div id="login-modal">
            <img src="logo.svg" alt="S.A.L.T Logo" class="login-logo">
            <h2>S.A.L.T</h2>
            <p class="login-subtitle">Sharing And Living Together</p>
            <form id="login-form">
                <div class="test-account-hint">
                    <p style="margin-bottom:8px;">Easy Login for Demo:</p>
                    <div class="test-numbers">
                        <button type="button" class="test-number-chip" data-phone="9800000001">Admin</button>
                        <button type="button" class="test-number-chip" data-phone="9800000002">Pastor</button>
                        <button type="button" class="test-number-chip" data-phone="1234">User</button>
                    </div>
                </div>
                <input type="tel" id="phone-input" placeholder="Enter Phone Number" required autocomplete="tel">
                <button type="submit" id="send-code-btn" class="login-btn">Sign In</button>
                 <p id="login-error"></p>
            </form>
        </div>
    </div>

    <!-- Admin Panel Overlay -->
    <div id="admin-panel-overlay" class="modal-overlay hidden">
        <div class="admin-panel">
             <div class="admin-header">
                <h2>Admin Panel</h2>
                <button id="exit-admin-mode-btn" style="background:none; border:none; color:white; font-size:1.5rem;">&times;</button>
            </div>
            <div class="admin-content" style="padding:1rem;">
                <div class="admin-section">
                    <h3>Manage Members</h3>
                    <ul id="admin-members-list" style="list-style:none; margin-top:1rem;"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Structure -->
    <div id="app-container">
        <header>
            <div style="width: 40px;"></div> 
            <h1 id="header-title">Welcome</h1>
            <div class="header-actions">
                <button id="notification-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>
                    <span id="notification-badge" class="hidden"></span>
                </button>
                <button id="more-menu-btn">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
                </button>
                <div id="more-menu-dropdown" class="dropdown-menu hidden">
                    <button id="dropdown-admin-btn">Admin Mode</button>
                    <button id="dropdown-logout-btn">Logout</button>
                </div>
            </div>
        </header>

        <div id="notification-panel" class="hidden">
            <ul id="notification-list"></ul>
        </div>

        <main>
            <!-- Welcome -->
            <section id="welcome" class="content-section active">
                <div id="welcome-hero">
                     <img src="https://images.unsplash.com/photo-1508361001413-762174338279?q=80&w=2070&auto=format&fit=crop" alt="Church" />
                    <div class="hero-content">
                        <h2 id="welcome-church-name">Welcome!</h2>
                        <p id="welcome-message">Please select a church.</p>
                    </div>
                </div>
            </section>

            <!-- Live Service -->
            <section id="live" class="content-section">
                <div class="page-padding">
                    <div class="card">
                        <h2 style="margin-bottom:1rem; color:var(--text-color);">‡§Ü‡§∞‡§ß‡§®‡§æ (Worship)</h2>
                        <div class="video-player-container">
                            <iframe id="video-player" src="" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <h3 style="margin-top:1.5rem; margin-bottom:0.5rem; font-size:1rem; color:var(--text-color);">Recent Sermons</h3>
                        <ul id="sermon-list" style="list-style:none;"></ul>
                    </div>
                </div>
            </section>

            <!-- Prayer -->
            <section id="prayer" class="content-section">
                <div class="page-padding">
                    <h2 style="margin-bottom:1rem; color:var(--text-color); padding-left:4px;">‡§™‡•ç‡§∞‡§æ‡§∞‡•ç‡§•‡§®‡§æ (Prayer)</h2>
                    <div class="card">
                        <form id="prayer-form">
                            <input type="text" id="prayer-title-input" placeholder="Title" required>
                            <textarea id="prayer-input" placeholder="Share your prayer request..." required></textarea>
                            <input type="file" id="prayer-image-input" accept="image/*" hidden>
                            <label for="prayer-image-input" class="file-input-label">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                                <span>Add Photo</span>
                                <span id="prayer-image-filename" style="margin-left:auto; font-size:0.8rem; color:var(--text-light);"></span>
                            </label>
                            <button type="submit">Post Prayer</button>
                        </form>
                    </div>
                    <div id="prayer-list"></div>
                </div>
            </section>
            
            <!-- Bible -->
            <section id="bible" class="content-section">
                <div class="page-padding">
                    <h2 style="margin-bottom:1rem; color:var(--text-color); padding-left:4px;">‡§¨‡§æ‡§á‡§¨‡§≤ (Bible)</h2>
                    <div class="card">
                        <h3>üìñ Daily Devotion</h3>
                        <p style="margin-top:0.5rem; line-height:1.5;">Today's message will appear here.</p>
                        <span class="news-date" id="daily-life-date"></span>
                    </div>
                    <div class="card">
                        <h3>Reading Plan</h3>
                        <div id="bible-reading-plan"></div>
                    </div>
                </div>
            </section>

            <!-- News -->
            <section id="news" class="content-section">
                 <div class="page-padding">
                    <h2 style="margin-bottom:1rem; color:var(--text-color); padding-left:4px;">‡§∏‡•Å‡§ö‡§®‡§æ (News)</h2>
                    <div id="news-list"></div>
                </div>
            </section>

            <!-- Chat -->
            <section id="chat" class="content-section">
                <!-- Chat List -->
                <div id="chat-list-view" class="active" style="height:100%;">
                    <div id="chat-list-container"></div>
                    <button id="new-chat-fab" class="fab">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                    </button>
                </div>

                <!-- Chat Detail -->
                <div id="chat-detail-view">
                    <div class="chat-header">
                        <button id="chat-back-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                        </button>
                        <h3 id="chat-detail-title">Chat</h3>
                    </div>
                    <div class="chat-messages"></div>
                    <div class="chat-input-area">
                        <button class="chat-action-btn">
                             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 0 1 5 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5a2.5 2.5 0 0 0 5 0V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/></svg>
                        </button>
                        <textarea id="chat-input" placeholder="Message" rows="1"></textarea>
                        <button id="chat-send-btn" class="chat-action-btn">
                             <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                        </button>
                    </div>
                    <div id="emoji-picker" class="emoji-picker"></div>
                </div>

                <!-- New Chat Search -->
                <div id="new-chat-view">
                     <div class="chat-header">
                        <button id="new-chat-back-btn" style="background:none; border:none; font-size:1.5rem; margin-right:1rem;">&lt;</button>
                        <h3>New Chat</h3>
                    </div>
                    <div class="search-container">
                        <input type="search" id="user-search-input" placeholder="Search people...">
                    </div>
                    <div id="user-list-container" style="flex:1; overflow-y:auto;"></div>
                </div>
            </section>
        </main>

        <nav class="bottom-nav">
            <button class="nav-item active" data-target="welcome">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                <span>‡§∏‡•ç‡§µ‡§æ‡§ó‡§§‡§Æ</span>
            </button>
            <button class="nav-item" data-target="live">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                <span>‡§Ü‡§∞‡§ß‡§®‡§æ</span>
            </button>
            <button class="nav-item" data-target="news">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM8 17H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2zm10 8h-8v-2h8v2zm0-4h-8v-2h8v2zm0-4h-8V7h8v2z"/></svg>
                <span>‡§∏‡•Å‡§ö‡§®‡§æ</span>
            </button>
            <button class="nav-item" data-target="bible">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/></svg>
                <span>‡§¨‡§æ‡§á‡§¨‡§≤</span>
            </button>
            <button class="nav-item" data-target="prayer">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16.5 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-3.5 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-3.5 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-3.5 0C4.9 6 4 6.9 4 8s.9 2 2 2 2-.9 2-2-.9-2-2-2zM4 14.5c0-.83.67-1.5 1.5-1.5h13c.83 0 1.5.67 1.5 1.5v.5h-16v-.5zM20 18H4v-1.5h16V18zM4 21.5h16V20H4v1.5z"/></svg>
                <span>‡§™‡•ç‡§∞‡§æ‡§∞‡•ç‡§•‡§®‡§æ</span>
            </button>
            <button class="nav-item" data-target="chat">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
                <span>‡§∏‡§Ç‡§ó‡§§‡§ø</span>
            </button>
        </nav>
    </div>

    <script>
    // --- APP DATA ---
    const mockUsers = {
        '9800000001': { userId: 'user1', churchId: 'grace-church', name: 'Admin User' },
        '9800000002': { userId: 'user5', churchId: 'hope-fellowship', name: 'Pastor David' },
        '1234': { userId: 'user1', churchId: 'grace-church', name: 'Test User' }
    };

    const mockDatabase = {
        'grace-church': {
            name: 'Grace Community Church',
            welcomeMessage: 'We are so glad you\'re here. Our community is a place where you can find love, hope, and a family in Christ.',
            liveServiceVideoId: '5qap5aO4i9A',
            members: [
                { id: 'user1', name: 'Admin User', isAdmin: true, avatarColor: '#3f51b5' },
                { id: 'user2', name: 'Pastor John', isAdmin: false, avatarColor: '#e91e63' },
                { id: 'user3', name: 'Jane Doe', isAdmin: false, avatarColor: '#009688' },
            ],
            sermons: [{ videoId: 'Y-i4p4O7a_0', title: 'The Courage to Hope', speaker: 'Pastor John', date: 'May 19' }, { videoId: 'jNQXAC9IVRw', title: 'Love That Transforms', speaker: 'Pastor Jane', date: 'May 12' }],
            prayers: [{ id: 'p1', postedBy: 'user3', timestamp: new Date().toISOString(), title: 'Family Health', text: 'Please pray for my family health and protection.', prayedCount: 12 }],
            news: [
                { title: 'Summer Retreat', text: 'Registration for the annual summer retreat is now open! Sign up by June 15th.', date: 'May 15, 2024' },
                { title: 'Community Lunch', text: 'Join us for lunch after the service this Sunday.', date: 'May 20, 2024' }
            ],
            chats: [
                { id: 'chat1', name: 'Youth Group', type: 'group', members: ['user1', 'user3'], preview: 'Sounds good!', avatarColor: '#e91e63' },
                { id: 'chat2', name: 'Pastor John', type: 'direct', members: ['user1', 'user2'], preview: 'See you tomorrow.', avatarColor: '#3f51b5' }
            ]
        },
        'hope-fellowship': {
            name: 'Hope Fellowship',
            welcomeMessage: 'Welcome to Hope Fellowship!',
            liveServiceVideoId: 'tSBFz_MDnLs',
            members: [{ id: 'user5', name: 'Pastor David', isAdmin: true, avatarColor: '#009688' }],
            sermons: [],
            prayers: [],
            news: [],
            chats: []
        }
    };

    let currentChurchId = null;
    let churchData = null;
    let currentUser = null;

    // --- INITIALIZATION ---
    (function() {
        if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
        else init();
    })();

    function init() {
        const saved = localStorage.getItem('churchAppSession');
        if(saved) {
            try {
                const s = JSON.parse(saved);
                if(s && mockUsers[s.phone]) loginSuccess(s.phone, true);
                else showLogin();
            } catch(e) { showLogin(); }
        } else {
            showLogin();
        }

        setupEvents();
    }

    function setupEvents() {
        // Login
        document.getElementById('login-form')?.addEventListener('submit', (e) => { e.preventDefault(); handleLogin(); });
        document.getElementById('send-code-btn')?.addEventListener('click', (e) => { e.preventDefault(); handleLogin(); });
        
        // Test Chips
        document.querySelectorAll('.test-number-chip').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('phone-input').value = btn.dataset.phone;
                handleLogin();
            });
        });

        // Navigation
        document.querySelectorAll('.nav-item').forEach(btn => {
            btn.addEventListener('click', () => {
                const target = btn.dataset.target;
                if(target) showSection(target);
            });
        });

        // More Menu
        document.getElementById('more-menu-btn')?.addEventListener('click', (e) => {
            e.stopPropagation();
            document.getElementById('more-menu-dropdown').classList.toggle('hidden');
        });
        document.getElementById('dropdown-logout-btn')?.addEventListener('click', logout);

        // Chat
        document.getElementById('chat-back-btn')?.addEventListener('click', showChatList);
        document.getElementById('chat-send-btn')?.addEventListener('click', sendChatMessage);
        
        // Global clicks
        document.addEventListener('click', (e) => {
            if(!e.target.closest('#more-menu-btn') && !e.target.closest('#more-menu-dropdown')) {
                document.getElementById('more-menu-dropdown')?.classList.add('hidden');
            }
        });
    }

    // --- LOGIN LOGIC ---
    function handleLogin() {
        const phone = document.getElementById('phone-input').value.replace(/\D/g, '');
        if(mockUsers[phone]) loginSuccess(phone);
        else {
             const err = document.getElementById('login-error');
             if(err) err.textContent = "User not found.";
        }
    }

    function loginSuccess(phone, silent) {
        const user = mockUsers[phone];
        currentChurchId = user.churchId;
        churchData = mockDatabase[currentChurchId];
        currentUser = { ...user, ...churchData.members.find(m => m.id === user.userId) };
        
        localStorage.setItem('churchAppSession', JSON.stringify({ phone, userId: currentUser.userId }));
        
        const overlay = document.getElementById('login-overlay');
        overlay.classList.remove('active');
        overlay.classList.add('hidden'); // Force hide styling
        
        loadChurchData();
        if(!silent) showSection('welcome');
    }

    function showLogin() {
        const overlay = document.getElementById('login-overlay');
        overlay.classList.remove('hidden');
        overlay.classList.add('active');
    }

    function logout() {
        localStorage.removeItem('churchAppSession');
        location.reload();
    }

    // --- VIEW LOGIC ---
    function showSection(id) {
        document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(el => el.classList.toggle('active', el.dataset.target === id));
        
        const titleMap = { welcome: churchData.name, live: '‡§Ü‡§∞‡§ß‡§®‡§æ', prayer: '‡§™‡•ç‡§∞‡§æ‡§∞‡•ç‡§•‡§®‡§æ', bible: '‡§¨‡§æ‡§á‡§¨‡§≤', news: '‡§∏‡•Å‡§ö‡§®‡§æ', chat: '‡§∏‡§Ç‡§ó‡§§‡§ø' };
        document.getElementById('header-title').textContent = titleMap[id] || 'S.A.L.T';

        if(id === 'chat') showChatList();
    }

    function loadChurchData() {
        if(!churchData) return;
        
        document.getElementById('welcome-church-name').textContent = churchData.name;
        document.getElementById('welcome-message').textContent = churchData.welcomeMessage;
        
        // Sermons
        const sList = document.getElementById('sermon-list');
        sList.innerHTML = '';
        churchData.sermons.forEach(s => {
            const li = document.createElement('li');
            li.style.cssText = "padding:10px 0; border-bottom:1px solid #eee; cursor:pointer;";
            li.innerHTML = `<div style="font-weight:500;">${s.title}</div><div style="font-size:0.8rem; color:#888;">${s.speaker} ‚Ä¢ ${s.date}</div>`;
            li.onclick = () => document.getElementById('video-player').src = `https://www.youtube.com/embed/${s.videoId}`;
            sList.appendChild(li);
        });
        if(churchData.liveServiceVideoId) {
             document.getElementById('video-player').src = `https://www.youtube.com/embed/${churchData.liveServiceVideoId}`;
        }

        // News (Fix: Structure matched to new CSS)
        const nList = document.getElementById('news-list');
        nList.innerHTML = '';
        churchData.news.forEach(n => {
            const div = document.createElement('div');
            div.className = 'news-card';
            div.innerHTML = `<h3>${n.title}</h3><p>${n.text}</p><span class="news-date">${n.date}</span>`;
            nList.appendChild(div);
        });

        // Prayer (Fix: Proper Flexbox Structure)
        const pList = document.getElementById('prayer-list');
        pList.innerHTML = '';
        churchData.prayers.forEach(p => {
            const user = churchData.members.find(m => m.id === p.postedBy) || { name:'Unknown', avatarColor:'#ccc' };
            const div = document.createElement('div');
            div.className = 'prayer-card';
            div.innerHTML = `
                <div class="prayer-card-header">
                    <div class="prayer-card-avatar" style="background-color:${user.avatarColor};">${user.name.charAt(0)}</div>
                    <div class="prayer-card-userinfo">
                        <span class="prayer-card-username">${user.name}</span>
                        <span class="prayer-card-time">${new Date(p.timestamp).toLocaleDateString()}</span>
                    </div>
                </div>
                <div class="prayer-card-content">
                    <h3>${p.title}</h3>
                    <p>${p.text}</p>
                </div>
                <div class="prayer-card-actions">
                    <button class="action-btn">üôè Pray (${p.prayedCount})</button>
                </div>
            `;
            pList.appendChild(div);
        });

        // Chat List
        const cList = document.getElementById('chat-list-container');
        cList.innerHTML = '';
        churchData.chats.forEach(chat => {
            const div = document.createElement('div');
            div.className = 'chat-list-item';
            div.innerHTML = `
                <div class="chat-avatar" style="background-color:${chat.avatarColor}">${chat.name.charAt(0)}</div>
                <div class="chat-list-details">
                    <div class="chat-list-title">${chat.name}</div>
                    <div class="chat-list-preview">${chat.preview}</div>
                </div>
            `;
            div.onclick = () => openChat(chat);
            cList.appendChild(div);
        });
    }

    // --- CHAT FUNCTIONS ---
    function showChatList() {
        document.getElementById('chat-list-view').classList.add('active');
        document.getElementById('chat-detail-view').classList.remove('active');
        document.getElementById('header-title').textContent = '‡§∏‡§Ç‡§ó‡§§‡§ø';
        // Show global header/nav
        document.querySelector('header').style.display = 'flex';
        document.querySelector('.bottom-nav').style.display = 'flex';
    }

    function openChat(chat) {
        currentChat = chat;
        document.getElementById('chat-list-view').classList.remove('active');
        document.getElementById('chat-detail-view').classList.add('active');
        document.getElementById('chat-detail-title').textContent = chat.name;
        
        // Hide global nav for immersive chat
        document.querySelector('.bottom-nav').style.display = 'none';
        document.querySelector('header').style.display = 'none';

        const msgs = document.querySelector('.chat-messages');
        msgs.innerHTML = `<div class="message-bubble other">Welcome to ${chat.name}!</div>`;
    }

    function sendChatMessage() {
        const input = document.getElementById('chat-input');
        const text = input.value.trim();
        if(!text) return;

        const msgs = document.querySelector('.chat-messages');
        const bubble = document.createElement('div');
        bubble.className = 'message-bubble me';
        bubble.textContent = text;
        msgs.appendChild(bubble);
        msgs.scrollTop = msgs.scrollHeight;
        input.value = '';
    }
    </script>
</body>
</html>